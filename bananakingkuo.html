<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¶“åœ‹åœ‹ï½œæ–°é®®é¦™è•‰é è³¼</title>
  <meta name="description" content="ç¶“åœ‹åœ‹è²©å”®æ–°é®®é¦™è•‰ï¼Œç·šä¸Šç™»è¨˜å§“åã€ä¸²æ•¸ã€é›»è©±ã€å–è²¨æ™‚é–“ã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #FFFDF6;
      --brand: #FFD166; /* é¦™è•‰é»ƒ */
      --brand-dark: #F2C14E;
      --ink: #2A2A2A;
      --muted: #6B7280;
      --ok: #10B981;
      --err: #EF4444;
      --card: #FFFFFF;
      --ring: #f8e5ad;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:"Noto Sans TC", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    header{display:grid;grid-template-columns:72px 1fr;gap:16px;align-items:center;margin-top:8px}
    .logo{width:72px;height:72px;border-radius:18px;background:linear-gradient(135deg,#FFF2C7, #FFEAA0);display:grid;place-items:center;border:2px solid var(--ring)}
    .logo svg{width:46px;height:46px}
    h1{margin:0;font-size:clamp(24px,4vw,36px);font-weight:800;line-height:1.1}
    .sub{color:var(--muted);margin-top:6px}

    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;margin-top:24px}
    @media (max-width: 900px){.grid{grid-template-columns:1fr;}}

    .card{background:var(--card);border:1px solid #eee;border-radius:16px;padding:18px 18px 20px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
    .card h2{margin:0 0 10px;font-size:20px}

    .hero-img{border-radius:14px;overflow:hidden;border:1px solid #eee}
    .hero-img img{display:block;width:100%;height:auto}
    .caption{font-size:12px;color:var(--muted);margin-top:6px}

    form{display:grid;gap:12px;margin-top:6px}
    label{font-weight:600;font-size:14px}
    input, select, button, textarea{font:inherit}
    .field{display:grid;gap:6px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:700px){.row{grid-template-columns:1fr}}

    input, select{padding:12px 14px;border:1px solid #E5E7EB;border-radius:12px;background:#fff;outline:none}
    input:focus, select:focus{border-color:var(--brand-dark);box-shadow:0 0 0 6px var(--ring)}
    .help{font-size:12px;color:var(--muted)}

    .price{display:flex;gap:10px;align-items:center;margin:6px 0 10px}
    .pill{padding:6px 10px;border-radius:999px;background:#FFF4CF;border:1px solid #FDE68A;font-weight:600}

    .btn{padding:12px 16px;border:0;border-radius:12px;background:var(--brand);font-weight:800}
    .btn:hover{background:var(--brand-dark);cursor:pointer}

    .notice{margin-top:10px;padding:10px 12px;border-radius:12px;background:#F0FDF4;border:1px solid #DCFCE7;color:#14532D;font-size:14px;display:none}
    .notice.err{background:#FEF2F2;border-color:#FEE2E2;color:#7F1D1D}

    .admin{margin-top:24px}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th{font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);text-align:left}
    td, th{padding:8px 10px}
    tbody tr{background:#fff;border:1px solid #eee}
    tbody tr>td:first-child{border-radius:10px 0 0 10px}
    tbody tr>td:last-child{border-radius:0 10px 10px 0}
    .actions button{font-size:12px;border:1px solid #eee;background:#fff;border-radius:10px;padding:6px 10px}
    .actions button:hover{background:#f6f6f6;cursor:pointer}

    footer{margin:36px 0 12px;color:var(--muted);font-size:12px}
    .req{color:var(--err)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true">
        <!-- é¦™è•‰åœ–ç¤ºï¼ˆå‘é‡ï¼‰ -->
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M59 14c-2 1-4 1-6 0-3 7-9 14-18 18S16 35 9 32c-1 2-1 4 0 6 4 7 14 12 25 9 11-2 20-12 23-23 1-4 2-8 2-10Z" fill="#FFD166" stroke="#E7B74B" stroke-width="2"/>
          <path d="M58 11c.5 2 .6 4 .3 6-2 11-12 21-23 23-11 3-21-2-25-9M53 13c1 0 3 0 5-2" stroke="#9A7B2F" stroke-width="2" stroke-linecap="round"/>
          <path d="M7 30c2 1 4 2 6 2" stroke="#9A7B2F" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <h1>ç¶“åœ‹åœ‹çš„é¦™è•‰å°èˆ– ğŸŒ</h1>
        <p class="sub">ç”¢åœ°ç›´é€ãƒ»æ–°é®®ç”œé¦™ãƒ»æ­¡è¿é è³¼è‡ªå–</p>
      </div>
    </header>

    <div class="grid">
      <!-- å·¦å´ï¼šé¦™è•‰ç…§ç‰‡èˆ‡èªªæ˜ -->
      <section class="card">
        <h2>ä»Šæ—¥é¦™è•‰</h2>
        <div class="hero-img">
          <!--
            âœ… è«‹æŠŠé¦™è•‰ç…§ç‰‡æ”¾åˆ° /images/banana.jpg
            ç„¶å¾Œè®“ä¸‹è¡Œçš„ src æŒ‡å‘è©²æª”æ¡ˆã€‚
            ä½ ä¹Ÿå¯ä»¥æ”¹æˆç·šä¸Šåœ–ç‰‡ç¶²å€ã€‚
          -->
          <img src="images/banana.jpg" alt="æ–°é®®é¦™è•‰ç…§ç‰‡ï¼ˆç¤ºæ„ï¼‰" />
        </div>
        <p class="caption">ç…§ç‰‡ç‚ºç¤ºæ„ï¼Œå¯¦éš›ä»¥ç•¶æ—¥åˆ°è²¨ç‚ºæº–ã€‚</p>

        <div class="price">
          <span class="pill">è²©å”®è€…ï½œç¶“åœ‹åœ‹</span>
          <span class="pill">é è³¼å–®ä½ï½œä»¥ã€Œä¸²ã€ç‚ºå–®ä½</span>
        </div>
        <p class="help">å¦‚éœ€å¤§é‡è¨‚è³¼æˆ–å¤–é€ï¼Œè«‹æ–¼å‚™è¨»èªªæ˜æˆ–é›»æ´½ã€‚</p>
      </section>

      <!-- å³å´ï¼šé è³¼è¡¨å–® -->
      <section class="card">
        <h2>é è³¼ç™»è¨˜è¡¨å–®</h2>
        <form id="orderForm" novalidate>
          <div class="field">
            <label for="name">å§“å <span class="req">*</span></label>
            <input id="name" name="name" type="text" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" required />
          </div>

          <div class="row">
            <div class="field">
              <label for="bunches">è³¼è²·ã€Œä¸²ã€æ•¸ <span class="req">*</span></label>
              <input id="bunches" name="bunches" type="number" inputmode="numeric" min="1" step="1" placeholder="ä¾‹å¦‚ 2" required />
              <div class="help">æ¯ 1 ä¸²ç‚ºä¸€å–®ä½ï¼Œè«‹å¡«å¯«æ•´æ•¸ã€‚</div>
            </div>
            <div class="field">
              <label for="pickup">å–è²¨æ™‚é–“ <span class="req">*</span></label>
              <input id="pickup" name="pickup" type="datetime-local" required />
              <div class="help">è«‹é¸æ“‡æ‚¨æ–¹ä¾¿å‰ä¾†å–è²¨çš„æ™‚é–“ã€‚</div>
            </div>
          </div>

          <div class="field">
            <label for="phone">è¯çµ¡é›»è©± <span class="req">*</span></label>
            <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="09xx-xxx-xxx" pattern="^(0|\+?886)[- ]?9\d{2}[- ]?\d{3}[- ]?\d{3}$" required />
            <div class="help">æ”¯æ´ 09 é–‹é ­æˆ– +886 æ‰‹æ©Ÿæ ¼å¼ï¼ˆå¯å« - ï¼‰ã€‚</div>
          </div>

          <div class="field">
            <label for="note">å‚™è¨»</label>
            <textarea id="note" name="note" rows="3" placeholder="ä¾‹ï¼šéœ€è¦æˆç†Ÿåº¦åé’/åé»ƒã€æ˜¯å¦è‡ªå‚™ç’°ä¿è¢‹â€¦"></textarea>
          </div>

          <button class="btn" type="submit">é€å‡ºé è³¼</button>
          <div id="msg" class="notice" role="status"></div>
        </form>
      </section>
    </div>

    <!-- å¾Œå°ç°¡æ˜“æ¸…å–®ï¼ˆåƒ…ç¤ºç¯„ï¼Œä¿å­˜åœ¨ç€è¦½å™¨ï¼‰ -->
    <section class="card admin" aria-labelledby="listHeading">
      <h2 id="listHeading">ç™»è¨˜æ¸…å–®ï¼ˆåƒ…æ­¤è£ç½®å¯è¦‹ï¼‰</h2>
      <p class="help">è³‡æ–™æš«å­˜æ–¼æœ¬æ©Ÿç€è¦½å™¨ï¼ˆlocalStorageï¼‰ï¼Œé‡æ–°æ•´ç†ä»ä¿ç•™ã€‚è‹¥éœ€æ­£å¼å¾Œç«¯ï¼Œå¯äº¤ç”± Google è¡¨å–®ã€Airtableã€æˆ–è‡ªæ¶ API ä¸²æ¥ã€‚</p>
      <div style="overflow:auto">
        <table id="ordersTable" aria-label="ç™»è¨˜æ¸…å–®">
          <thead>
            <tr>
              <th>æ™‚é–“</th>
              <th>å§“å</th>
              <th>ä¸²æ•¸</th>
              <th>é›»è©±</th>
              <th>å–è²¨æ™‚é–“</th>
              <th>å‚™è¨»</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="actions" style="display:flex;gap:8px;margin-top:10px">
        <button id="exportBtn" type="button">åŒ¯å‡º CSV</button>
        <button id="clearBtn" type="button" title="æ¸…ç©ºæ‰€æœ‰æœ¬æ©Ÿè³‡æ–™">æ¸…ç©º</button>
      </div>
    </section>

    <footer>
      Â© <span id="year"></span> ç¶“åœ‹åœ‹é¦™è•‰å°èˆ–ï¼æœ¬é é¢åƒ…åšç¤ºç¯„ï¼Œå¯¦éš›äº¤æ˜“ç´°ç¯€ä»¥è¯ç¹«ç‚ºæº–ã€‚
    </footer>
  </div>

  <script>
    const $ = (sel, el=document) => el.querySelector(sel)
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel))

    const form = $('#orderForm')
    const msg = $('#msg')
    const tableBody = $('#ordersTable tbody')
    const exportBtn = $('#exportBtn')
    const clearBtn = $('#clearBtn')

    const STORAGE_KEY = 'banana_orders_v1'

    function loadOrders(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]') } catch { return [] }
    }
    function saveOrders(list){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list))
    }
    function formatDT(v){
      if(!v) return ''
      const dt = new Date(v)
      if(Number.isNaN(dt.getTime())) return v
      const pad = n=>String(n).padStart(2,'0')
      return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())} ${pad(dt.getHours())}:${pad(dt.getMinutes())}`
    }

    function render(){
      const orders = loadOrders()
      tableBody.innerHTML = ''
      orders.forEach((o, idx)=>{
        const tr = document.createElement('tr')
        tr.innerHTML = `
          <td>${formatDT(o.createdAt)}</td>
          <td>${o.name}</td>
          <td>${o.bunches}</td>
          <td>${o.phone}</td>
          <td>${formatDT(o.pickup)}</td>
          <td>${o.note || ''}</td>
          <td><button data-idx="${idx}" class="del">åˆªé™¤</button></td>
        `
        tableBody.appendChild(tr)
      })
      // ç¶å®šåˆªé™¤
      $$('.del', tableBody).forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const idx = +e.currentTarget.dataset.idx
          const orders = loadOrders()
          orders.splice(idx,1)
          saveOrders(orders)
          render()
        })
      })
    }

    function showMsg(text, ok=true){
      msg.textContent = text
      msg.classList.toggle('err', !ok)
      msg.style.display = 'block'
      setTimeout(()=>{ msg.style.display = 'none' }, 4000)
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault()
      // åŸç”Ÿé©—è­‰
      if(!form.checkValidity()){
        showMsg('è«‹å®Œæ•´å¡«å¯«å¿…å¡«æ¬„ä½ï¼ˆå§“åï¼ä¸²æ•¸ï¼é›»è©±ï¼å–è²¨æ™‚é–“ï¼‰ã€‚', false)
        return
      }
      // é¡å¤–è¦å‰‡ï¼šä¸²æ•¸éœ€ç‚ºæ­£æ•´æ•¸
      const bunches = parseInt($('#bunches').value, 10)
      if(!(bunches > 0)){
        showMsg('ä¸²æ•¸è«‹è¼¸å…¥ 1 ä»¥ä¸Šçš„æ•´æ•¸ã€‚', false)
        return
      }

      const order = {
        id: crypto.randomUUID(),
        createdAt: new Date().toISOString(),
        name: $('#name').value.trim(),
        bunches,
        phone: $('#phone').value.trim(),
        pickup: $('#pickup').value,
        note: $('#note').value.trim()
      }
      const orders = loadOrders()
      orders.unshift(order)
      saveOrders(orders)
      render()
      form.reset()
      showMsg('é è³¼å·²é€å‡ºï¼æˆ‘å€‘å°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹«ç¢ºèªã€‚')
    })

    exportBtn.addEventListener('click', ()=>{
      const orders = loadOrders()
      if(!orders.length){ showMsg('ç›®å‰æ²’æœ‰å¯åŒ¯å‡ºçš„è³‡æ–™ã€‚', false); return }
      const header = ['å»ºç«‹æ™‚é–“','å§“å','ä¸²æ•¸','é›»è©±','å–è²¨æ™‚é–“','å‚™è¨»']
      const rows = orders.map(o=>[
        formatDT(o.createdAt), o.name, o.bunches, o.phone, formatDT(o.pickup), (o.note||'').replaceAll('\n',' ')
      ])
      const csv = [header, ...rows].map(r=>r.map(cell=>`"${String(cell).replaceAll('"','""')}"`).join(',')).join('\n')
      const blob = new Blob(["\ufeff" + csv], {type:'text/csv;charset=utf-8'})
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = `é¦™è•‰é è³¼æ¸…å–®_${new Date().toISOString().slice(0,10)}.csv`
      document.body.appendChild(a)
      a.click()
      a.remove()
      URL.revokeObjectURL(url)
    })

    clearBtn.addEventListener('click', ()=>{
      if(confirm('ç¢ºå®šè¦æ¸…ç©ºæœ¬æ©Ÿçš„æ‰€æœ‰ç™»è¨˜è³‡æ–™å—ï¼Ÿï¼ˆç„¡æ³•å¾©åŸï¼‰')){
        localStorage.removeItem(STORAGE_KEY)
        render()
      }
    })

    // é è¨­å–è²¨æ™‚é–“ï¼šè¨­ç‚ºæœ€è¿‘çš„æ•´é» + 2 å°æ™‚
    (function initPickupDefault(){
      const now = new Date()
      now.setMinutes(0,0,0)
      now.setHours(now.getHours()+2)
      const pad = n=>String(n).padStart(2,'0')
      const v = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`
      $('#pickup').value = v
    })()

    // footer å¹´ä»½
    $('#year').textContent = new Date().getFullYear()

  </script>
</body>
</html>
